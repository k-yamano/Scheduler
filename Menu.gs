/*******************************************
 * menu.gs
 * ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆoutputToCalendar è¿½åŠ ç‰ˆï¼‰
 *******************************************/

function onOpen() {
  const ui = SpreadsheetApp.getUi();
  const menu = ui.createMenu('ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼');

  // â”€â”€ 1. ãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const processMenu = ui.createMenu('âš™ï¸ 1. ãƒ‡ãƒ¼ã‚¿å‡¦ç†')
     .addItem('âœ¨ logã‚·ãƒ¼ãƒˆã«ãƒã‚¹ã‚¿æƒ…å ±ã‚’ä»˜ä¸', 'enrichLogSheetFromMasters'); // LogFrom.gs

  // â”€â”€ 2. ã‚·ãƒ¼ãƒˆãƒ»ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const viewMenu = ui.createMenu('ğŸ”„ 2. ã‚·ãƒ¼ãƒˆãƒ»ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼')
    .addItem('ğŸ”„ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»ï¼ˆå…¨å‡¦ç†ï¼‰', 'updateCalendar') // calendar.gs
    .addItem('ğŸ“ å•†å“æƒ…å ±ã‚’ "calendar" ã‚·ãƒ¼ãƒˆã«å‡ºåŠ›', 'outputToCalendar') // â˜…â˜…â˜… ã“ã‚Œã‚’è¿½åŠ ã—ã¾ã—ãŸ â˜…â˜…â˜…
    .addItem('ğŸ”§ ã‚·ãƒ¼ãƒˆã‚’æœˆé †ã«ã‚½ãƒ¼ãƒˆ', 'sortSheetsByMonth'); // LogFrom.gs

  // â”€â”€ 3. Pythoné€£æº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const pythonMenu = ui.createMenu('ğŸ 3. Pythoné€£æº')
     .addItem('ğŸ“¤ Pythonå…¥åŠ›CSVä¸€æ‹¬å‡ºåŠ›', 'exportAllSheetsForPython'); // csv.gs

  // â”€â”€ 4. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const backupMenu = ui.createMenu('ğŸ§° 4. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— (æ—¥ä»˜åˆ¥)')
    .addItem('ğŸ’¾ CSVä¿å­˜ï¼ˆlog â†’ æ—¥ä»˜ãƒ•ã‚©ãƒ«ãƒ€ï¼‰', 'backupLogSheet') // csv.gs
    .addItem('â¤´ CSVå¾©å…ƒï¼ˆæ—¥ä»˜ãƒ•ã‚©ãƒ«ãƒ€ â†’ logï¼‰', 'restoreLogFromBackupPrompt'); // csv.gs

  menu
    .addSubMenu(processMenu)
    .addSeparator()
    .addSubMenu(viewMenu) // â˜… ã€ŒoutputToCalendarã€ã¯ã“ã®ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«å«ã¾ã‚Œã¾ã™
    .addSeparator()
    .addSubMenu(pythonMenu)
    .addSeparator()
    .addSubMenu(backupMenu)
    .addSeparator()
    .addItem('ğŸ—‚ï¸ logã‚·ãƒ¼ãƒˆã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–', 'archiveLogData') // Archive.gs
    .addSeparator()
    .addItem('â“ ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰', 'showUsageGuide')
    .addToUi();
}

/**
 * ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ï¼ˆoutputToCalendar è¿½åŠ ç‰ˆï¼‰
 */
function showUsageGuide() {
  const ui = SpreadsheetApp.getUi();
  const msg =
    'ã€ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ â€“ ä½¿ã„æ–¹ã€‘\n\n' +
    '--- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ ---\n\n' +
    '1) ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ï¼š\n' +
    '   ãƒ»ã€Œyyyy/mmã€ã‚·ãƒ¼ãƒˆã«æ•°é‡ã‚’å…¥åŠ›ã—ã¾ã™ã€‚\n' +
    '   ãƒ»ï¼ˆâ†’ log.gs ãŒ logã‚·ãƒ¼ãƒˆã®Aã€œHåˆ—ã«è‡ªå‹•è¨˜éŒ²ã—ã¾ã™ï¼‰\n\n' +
    '2) âš™ï¸ ãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼š\n' +
    '   ãƒ»ã€Œâœ¨ logã‚·ãƒ¼ãƒˆã«ãƒã‚¹ã‚¿æƒ…å ±ã‚’ä»˜ä¸ã€ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\n' +
    '   ãƒ»ï¼ˆâ†’ logã‚·ãƒ¼ãƒˆã®Iåˆ—ä»¥é™ã«ã€ãƒã‚¹ã‚¿æƒ…å ±(Recipe, lineç­‰)ãŒè¿½è¨˜ã•ã‚Œã¾ã™ï¼‰\n\n' +
    '3) ğŸ Pythoné€£æºï¼š\n' +
    '   ãƒ»ã€ŒğŸ“¤ Pythonå…¥åŠ›CSVä¸€æ‹¬å‡ºåŠ›ã€ã‚’å®Ÿè¡Œã—ã€å®Œæˆã—ãŸ log.csv ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚\n\n' +
    '------------------------\n\n' +
    'ãƒ»ğŸ”„ ã‚·ãƒ¼ãƒˆãƒ»ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼š\n' +
    '   ã€ŒğŸ”„ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»ã€ã§ `yyyy/mm` ã‚·ãƒ¼ãƒˆã®æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æ›´æ–°ã—ã¾ã™ã€‚\n' +
    '   ã€ŒğŸ“ å•†å“æƒ…å ±ã‚’ "calendar" ã‚·ãƒ¼ãƒˆã«å‡ºåŠ›ã€ã§ã€`log` ã®å†…å®¹ã‚’ä¸€è¦§è¡¨ï¼ˆ"calendar"ã‚·ãƒ¼ãƒˆï¼‰ã«ã—ã¾ã™ã€‚\n\n' + // â˜… èª¬æ˜ã‚’è¿½åŠ 
    'ãƒ»ğŸ§° ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼š\n' +
    '   ã€Œlogã€ã‚·ãƒ¼ãƒˆã‚’æ—¥ä»˜åˆ¥ãƒ•ã‚©ãƒ«ãƒ€ (yyyymmdd/log.csv) ã«ä¿å­˜ãƒ»å¾©å…ƒã—ã¾ã™ã€‚\n';
  ui.alert('ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰', msg, ui.ButtonSet.OK);
}