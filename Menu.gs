/*******************************************
 * menu.gs
 * ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘æœ€é©åŒ–ãƒ»çµµæ–‡å­—ã‚ã‚Šï¼‰
 *******************************************/

function onOpen() {
  const ui = SpreadsheetApp.getUi();

  const menu = ui.createMenu('ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼');

  // â”€â”€ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç®¡ç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const calendarMenu = ui.createMenu('ğŸ“† ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç®¡ç†')
    .addItem('ğŸ”„ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ›´æ–°ï¼ˆå…¨å‡¦ç†ï¼‰', 'updateCalendar') // â† calendar å´ã®ãƒ¡ã‚¤ãƒ³
    .addItem('ğŸ“ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æ›¸ãè¾¼ã¿', 'writeToCalendar');   // â† ä»»æ„ã®å€‹åˆ¥æ›¸è¾¼ãŒã‚ã‚‹å ´åˆ

  // â”€â”€ ãƒ‡ãƒ¼ã‚¿æ›´æ–° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // â€» ã‚‚ã— "calendarå‡ºåŠ›" ãŒ LogFrom å´ã®é–¢æ•°ãªã‚‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰å‰Šé™¤
  //   ï¼ˆworkdayå‡ºåŠ›ã®äºŒé‡åŒ–é˜²æ­¢ã®ãŸã‚ï¼‰
  const dataMenu = ui.createMenu('ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ›´æ–°')
    .addItem('âœ… logã‚·ãƒ¼ãƒˆæ›´æ–°ï¼ˆãƒã‚¹ã‚¿CSVï¼‰', 'updateLogFromMasterCSV');

  // â”€â”€ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const backupMenu = ui.createMenu('ğŸ§° ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—')
    .addItem('ğŸ’¾ CSVä¿å­˜ï¼ˆlog â†’ Driveï¼‰', 'backupLogToDrive')
    .addItem('â¤´ CSVå¾©å…ƒï¼ˆDrive â†’ logï¼‰', 'restoreLogFromBackupPrompt');

  menu
    .addSubMenu(calendarMenu)
    .addSeparator()
    .addSubMenu(dataMenu)
    .addSeparator()
    .addSubMenu(backupMenu)
    .addSeparator()
    .addItem('ğŸ”§ ã‚·ãƒ¼ãƒˆã‚’æœˆé †ã«ã‚½ãƒ¼ãƒˆ', 'sortSheetsByMonth')
    .addSeparator()
    .addItem('â“ ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰', 'showUsageGuide')
    .addToUi();
}

function showUsageGuide() {
  const ui = SpreadsheetApp.getUi();
  const msg =
    'ã€ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ â€“ ä½¿ã„æ–¹ã€‘\n\n' +
    '1) ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ›´æ–°ï¼š\n' +
    '   ãƒ»ã€Œâœ… logã‚·ãƒ¼ãƒˆæ›´æ–°ï¼ˆãƒã‚¹ã‚¿CSVï¼‰ã€ã§ Drive ä¸Šã®ãƒã‚¹ã‚¿CSVã‚’å–ã‚Šè¾¼ã¿\n\n' +
    '2) ğŸ“† ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç®¡ç†ï¼š\n' +
    '   ãƒ»ã€ŒğŸ”„ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ›´æ–°ï¼ˆå…¨å‡¦ç†ï¼‰ã€ã§ä¸€æ‹¬æ›´æ–°ï¼ˆç¨¼åƒæ—¥CSVã®ä½œæˆã‚‚ã“ã“ã§å®Ÿæ–½ï¼‰\n' +
    '   ãƒ»ã€ŒğŸ“ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æ›¸ãè¾¼ã¿ã€ã§å¿…è¦ç®‡æ‰€ã ã‘åæ˜ \n\n' +
    '3) ğŸ§° ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼š\n' +
    '   ãƒ»ã€ŒğŸ’¾ CSVä¿å­˜ï¼ˆlog â†’ Driveï¼‰ã€ã§ç¾çŠ¶ã® log ã‚’é€€é¿\n' +
    '   ãƒ»ã€Œâ¤´ CSVå¾©å…ƒï¼ˆDrive â†’ logï¼‰ã€ã§ä»»æ„CSVã‚’å¾©å…ƒ\n\n' +
    '4) ãã®ä»–ï¼š\n' +
    '   ãƒ»ã€ŒğŸ”§ ã‚·ãƒ¼ãƒˆã‚’æœˆé †ã«ã‚½ãƒ¼ãƒˆã€ã§ã€Œyyyy/mmã€å½¢å¼ã®ã‚·ãƒ¼ãƒˆã‚’æ™‚ç³»åˆ—ã«æ•´åˆ—\n\n' +
    'â€» ãƒ­ã‚°ã¯ [INFO]/[WARN]/[ERROR] ã®ãƒ†ã‚­ã‚¹ãƒˆåŸºèª¿ï¼ˆæ“ä½œãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã¿çµµæ–‡å­—ã‚’ä½¿ç”¨ï¼‰';
  ui.alert('ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰', msg, ui.ButtonSet.OK);
}
